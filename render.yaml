name: firecrawl

services:
  - name: playwright-service
    env: node
    build:
      path: apps/playwright-service-ts
    plan: free
    ports:
      - 3000
    envVars:
      - key: PROXY_SERVER
        value: ${PROXY_SERVER}
      - key: PROXY_USERNAME
        value: ${PROXY_USERNAME}
      - key: PROXY_PASSWORD
        value: ${PROXY_PASSWORD}
      - key: BLOCK_MEDIA
        value: ${BLOCK_MEDIA}

  - name: api
    env: node
    build:
      path: apps/api
    plan: free
    ports:
      - 3002
    envVars:
      - key: REDIS_URL
        value: ${REDIS_URL:-redis://redis:6379}
      - key: PLAYWRIGHT_MICROSERVICE_URL
        value: ${PLAYWRIGHT_MICROSERVICE_URL:-http://playwright-service:3000/scrape}
      - key: USE_DB_AUTHENTICATION
        value: ${USE_DB_AUTHENTICATION}
      - key: OPENAI_API_KEY
        value: ${OPENAI_API_KEY}
      - key: OPENAI_BASE_URL
        value: ${OPENAI_BASE_URL}
      - key: MODEL_NAME
        value: ${MODEL_NAME}
      - key: SLACK_WEBHOOK_URL
        value: ${SLACK_WEBHOOK_URL}
      - key: BULL_AUTH_KEY
        value: ${BULL_AUTH_KEY}
      - key: TEST_API_KEY
        value: ${TEST_API_KEY}
      - key: POSTHOG_API_KEY
        value: ${POSTHOG_API_KEY}
      - key: POSTHOG_HOST
        value: ${POSTHOG_HOST}
      - key: SUPABASE_ANON_TOKEN
        value: ${SUPABASE_ANON_TOKEN}
      - key: SUPABASE_URL
        value: ${SUPABASE_URL}
      - key: SUPABASE_SERVICE_TOKEN
        value: ${SUPABASE_SERVICE_TOKEN}
      - key: SCRAPING_BEE_API_KEY
        value: ${SCRAPING_BEE_API_KEY}
      - key: SELF_HOSTED_WEBHOOK_URL
        value: ${SELF_HOSTED_WEBHOOK_URL}
      - key: SERPER_API_KEY
        value: ${SERPER_API_KEY}
      - key: SEARCHAPI_API_KEY
        value: ${SEARCHAPI_API_KEY}
      - key: LOGGING_LEVEL
        value: ${LOGGING_LEVEL}
      - key: PROXY_SERVER
        value: ${PROXY_SERVER}
      - key: PROXY_USERNAME
        value: ${PROXY_USERNAME}
      - key: PROXY_PASSWORD
        value: ${PROXY_PASSWORD}
      - key: HOST
        value: ${HOST:-0.0.0.0}
      - key: PORT
        value: ${INTERNAL_PORT:-3002}
      - key: FLY_PROCESS_GROUP
        value: app

  - name: worker
    env: node
    build:
      path: apps/api
    plan: free
    envVars:
      - key: REDIS_URL
        value: ${REDIS_URL:-redis://redis:6379}
      - key: PLAYWRIGHT_MICROSERVICE_URL
        value: ${PLAYWRIGHT_MICROSERVICE_URL:-http://playwright-service:3000/scrape}
      - key: USE_DB_AUTHENTICATION
        value: ${USE_DB_AUTHENTICATION}
      - key: OPENAI_API_KEY
        value: ${OPENAI_API_KEY}
      - key: OPENAI_BASE_URL
        value: ${OPENAI_BASE_URL}
      - key: MODEL_NAME
        value: ${MODEL_NAME}
      - key: SLACK_WEBHOOK_URL
        value: ${SLACK_WEBHOOK_URL}
      - key: BULL_AUTH_KEY
        value: ${BULL_AUTH_KEY}
      - key: TEST_API_KEY
        value: ${TEST_API_KEY}
      - key: POSTHOG_API_KEY
        value: ${POSTHOG_API_KEY}
      - key: POSTHOG_HOST
        value: ${POSTHOG_HOST}
      - key: SUPABASE_ANON_TOKEN
        value: ${SUPABASE_ANON_TOKEN}
      - key: SUPABASE_URL
        value: ${SUPABASE_URL}
      - key: SUPABASE_SERVICE_TOKEN
        value: ${SUPABASE_SERVICE_TOKEN}
      - key: SCRAPING_BEE_API_KEY
        value: ${SCRAPING_BEE_API_KEY}
      - key: SELF_HOSTED_WEBHOOK_URL
        value: ${SELF_HOSTED_WEBHOOK_URL}
      - key: SERPER_API_KEY
        value: ${SERPER_API_KEY}
      - key: SEARCHAPI_API_KEY
        value: ${SEARCHAPI_API_KEY}
      - key: LOGGING_LEVEL
        value: ${LOGGING_LEVEL}
      - key: PROXY_SERVER
        value: ${PROXY_SERVER}
      - key: PROXY_USERNAME
        value: ${PROXY_USERNAME}
      - key: PROXY_PASSWORD
        value: ${PROXY_PASSWORD}
      - key: FLY_PROCESS_GROUP
        value: worker

  - name: redis
    env: redis
    plan: free
    ports:
      - 6379
